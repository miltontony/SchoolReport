{% extends "base.html" %}
{% load comments %}

{% block content %}
<div class="row">
    <span class="span4">
    <img src="http://maps.googleapis.com/maps/api/staticmap?center={{school.latitude}},{{school.longitude}}&amp;markers=color:blue|label:S|{{school.latitude}},{{school.longitude}}&amp;zoom=12&amp;size=240x320&amp;sensor=false&amp;"/>
    </span>
    <span class="span6">
    School: {{school.name}} <br/>
    Average Fees: {{school.fee}} <br/>
    Principal: {{school.principal}} <br/>
    Address: {{school.physical_address}}
    </span>
</div>

{% if user.is_authenticated %}
<div class="row">
<div id="user_report_list" class="span12 comment_list">
    {% for user_report in user_report_list.object_list %}

            <div class="well" style="margin:10px 0">
                <!-- link to user profile -->
                            Anon.
                    <span class="subtext">
                    - {{ user_report.submit_date|date:"D, j M Y, H:i" }}
                </span>
                :: {{user_report.get_category}}
            </div>

            <div>{% spaceless %}
                {% if user_report.is_community_moderated %}
                    <strong>Moderated:</strong> {{ user_report.community_moderation_flags.latest.reason }}
                {% else %}
                    {% if user_report.is_moderated %}
                        <strong>Moderated:</strong> {{ user_report.moderation_flags.latest.reason }}
                    {% else %}
                        {{ user_report.comment }}
                    {% endif %}
                {% endif %}{% endspaceless %}
            </div>

            <div >
                    {% if user.is_authenticated %}
                        <a href="{% url comment_like user_report.pk %}">
                        <span class="label label-info">
                            {{ user_report.like_count }} Like{{ user_report.like_count|pluralize }}
                        </span>
                        </a>
                    {% else %}
                        <span class="label label-info">
                            {{ user_report.like_count }} Like{{ user_report.like_count|pluralize }}
                        </span>
                    {% endif %}
                    {% if user.is_authenticated %}
                    <a href="{% url comment_flag user_report.pk %}">
                        <span class="label label-important pull-right">Report</span>
                    </a>
                    {% endif %}
            </div>

    {% endfor %}
</div>
</div>
<br/>

<div class="well" style="padding: 5px">
<div id="pagination">
    {% if user_report_list.has_previous %}
        <span><a href="{% url home user_report_list.previous_page_number %}">Previous</a></span> |
    {% else %}
        <span>Previous</span> |
    {% endif %}

    <span class="current">
        Page {{ user_report_list.number }} of {{ user_report_list.paginator.num_pages }}
    </span>

    {% if user_report_list.has_next %}
        | <span><a href="{% url home user_report_list.next_page_number %}">Next</a></span>
    {% else %}
        | <span>Next</span>
    {% endif %}
</div>
</div>


<br/>



<div class="well" id="comment_form">
    {% get_comment_form for school as form %}

    <form action="{% comment_form_target %}" method="post">
        {% csrf_token %}
        <div style="display:none;">
            {{ form.content_type }}
            {{ form.object_pk }}
            {{ form.timestamp }}
            {{ form.security_hash }}
            {{ form.honeypot }}
            <input type="hidden" name="next" value="{% url home %}#user_report_list" />
        </div>

        <p>
            <label for="form-school">What do you want to report?</label>
            {% include "form_field_errors_snippet.html" with form_field=form.category %}
            <select name="category">
                <option value="">Please choose an option</option>
                <option value="0">Maintenance</option>
                <option value="1">Abuse</option>
                <option value="2">Textbooks</option>
                <option value="3">Crime</option>
                <option value="4">Bullying</option>
            </select><br/>
            Write your report:
            <br/>
            {% include "form_field_errors_snippet.html" with form_field=form.comment %}
            <textarea id="id_comment" rows="4" name="comment" class="span11"></textarea>
        </p>
        <div class="form-actions">
            <input type="submit" name="post" value="Post" class="btn btn-primary"/>
        </div>
    </form>

</div>
{% endif %}
{% endblock %}
